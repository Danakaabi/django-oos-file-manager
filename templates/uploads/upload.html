<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>رفع ملف</title>

  <!--
    ✅ جاهز للمشاركة (Production-friendly Template)
    - ألوان مختارة: Latte Glass (Rose Milk + Soft Lilac + Mint Glow) بدون أزرق قوي
    - كود خفيف ومنظم + تعليقات واضحة
    - أمان: CSRF موجود، و JS لا يستخدم innerHTML، والتحقق الحقيقي للحجم/النوع يكون في السيرفر
    - UX: Click + Drag&Drop + دعم لوحة المفاتيح + رسالة توضيحية
  -->

  <style>
    /* =========================
      THEME: Latte Glass (Soft & Premium)
      rose milk + lilac + mint glow
    ========================== */
    :root{
      --bg0:#090A12;
      --bg1:#0E1020;

      --card: rgba(255,255,255,.07);
      --stroke: rgba(255,255,255,.10);

      --tx:#F4F0FF;
      --mut: rgba(244,240,255,.66);

      --rose:#F6B3C8;   /* primary accent */
      --lilac:#C9B6FF;  /* secondary accent */
      --mint:#A8F0D6;   /* subtle glow */

      --ok:#79E7C2;
      --warn:#F7D27D;
      --err:#FF8AA8;

      --r:24px;
      --sh: 0 22px 80px rgba(0,0,0,.58);

      /* focus ring */
      --ring-rose: 0 0 0 4px rgba(246,179,200,.14);
      --ring-mint: 0 0 0 4px rgba(168,240,214,.14);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:16px;
      font-family: system-ui,-apple-system,"Segoe UI","Tajawal",sans-serif;
      color:var(--tx);

      /* خلفية ناعمة + لمعات */
      background:
        radial-gradient(900px 520px at 18% 12%, rgba(246,179,200,.14), transparent 58%),
        radial-gradient(900px 520px at 85% 18%, rgba(201,182,255,.12), transparent 60%),
        radial-gradient(900px 520px at 52% 98%, rgba(168,240,214,.10), transparent 58%),
        linear-gradient(145deg,var(--bg0),var(--bg1));
    }

    /* =========================
      CARD
    ========================== */
    .card{
      width:100%;
      max-width:520px;
      padding:24px;
      border-radius:var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.09), var(--card));
      border:1px solid var(--stroke);
      box-shadow:var(--sh);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    /* =========================
      HEADER
    ========================== */
    .header{
      display:flex;
      gap:14px;
      align-items:flex-start;
    }
    .icon{
      width:46px;height:46px;
      border-radius:16px;
      display:grid;place-items:center;
      background: linear-gradient(135deg, rgba(246,179,200,.18), rgba(201,182,255,.14));
      border:1px solid rgba(255,255,255,.14);
      flex:0 0 auto;
    }
    h1{
      margin:0;
      font-size:1.18rem;
      font-weight:950;
      letter-spacing:.2px;
    }
    .sub{
      margin-top:6px;
      font-size:.92rem;
      line-height:1.55;
      color:var(--mut);
    }

    /* =========================
      MESSAGES (Django messages)
    ========================== */
    .msg{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .dot{
      width:10px;height:10px;
      border-radius:999px;
      margin-top:6px;
      background: var(--lilac);
      box-shadow: 0 0 0 4px rgba(201,182,255,.14);
      flex:0 0 auto;
    }
    .msg.success .dot{ background: var(--ok);  box-shadow: 0 0 0 4px rgba(121,231,194,.14); }
    .msg.warning .dot{ background: var(--warn); box-shadow: 0 0 0 4px rgba(247,210,125,.14); }
    .msg.error   .dot{ background: var(--err); box-shadow: 0 0 0 4px rgba(255,138,168,.14); }

    /* =========================
      FORM
    ========================== */
    label{
      display:block;
      margin:6px 0 8px;
      font-size:.85rem;
      color:var(--mut);
    }

    /* نخفي input الحقيقي (نستخدم Dropzone) */
    input[type="file"]{
      position:absolute;
      opacity:0;
      width:1px;height:1px;
      pointer-events:none;
    }

    /* =========================
      DROPZONE
    ========================== */
    .drop{
      border-radius:18px;
      border:1px dashed rgba(255,255,255,.22);
      background: rgba(255,255,255,.045);
      padding:16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease, background .18s ease;
      outline:none;
    }
    .drop:hover{
      border-color: rgba(246,179,200,.45);
      box-shadow: var(--ring-rose);
      background: rgba(255,255,255,.055);
      transform: translateY(-1px);
    }
    .drop:focus-visible{
      border-color: rgba(246,179,200,.55);
      box-shadow: var(--ring-rose);
    }
    .drop.is-dragover{
      border-color: rgba(168,240,214,.55);
      box-shadow: var(--ring-mint);
      background: rgba(168,240,214,.05);
    }

    .meta{ min-width:0; }
    .meta strong{
      display:block;
      font-weight:950;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:310px;
    }
    .meta span{
      font-size:.82rem;
      color:var(--mut);
    }

    /* زر اختيار ملف */
    .pick{
      padding:10px 14px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--tx);
      font-weight:950;
      cursor:pointer;
      transition: transform .18s ease, filter .18s ease, background .18s ease;
    }
    .pick:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.08);
    }

    /* =========================
      SUBMIT
    ========================== */
    .btn{
      margin-top:2px;
      padding:14px;
      width:100%;
      border:0;
      border-radius:16px;
      font-weight:950;
      cursor:pointer;

      color:#120A1F;
      background: linear-gradient(135deg, var(--rose), var(--lilac));
      box-shadow: 0 16px 34px rgba(246,179,200,.14);
      transition: transform .18s ease, filter .18s ease, opacity .18s ease;
    }
    .btn:hover{ transform: translateY(-2px); filter: brightness(1.03); }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
      filter:none;
    }

    .hint{
      text-align:center;
      color: rgba(244,240,255,.55);
      font-size:.82rem;
      line-height:1.6;
      margin-top:2px;
    }

    @media (max-width:480px){
      .card{ padding:20px; }
      .meta strong{ max-width:220px; }
    }
  </style>
</head>

<body>
  <main class="card" role="main" aria-label="رفع ملف">
    <!-- ===== Header ===== -->
    <header class="header">
      <div class="icon" aria-hidden="true">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <path d="M12 3v10" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/>
          <path d="M8 7l4-4 4 4" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M5 14v4a3 3 0 003 3h8a3 3 0 003-3v-4" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/>
        </svg>
      </div>
      <div>
        <h1>رفع ملف</h1>
        <p class="sub">اسحبي الملف هنا أو اضغطي “اختيار ملف”.</p>
      </div>
    </header>

    <!-- ===== Django messages (اختياري) ===== -->
    {% if messages %}
      {% for message in messages %}
        <div class="msg {{ message.tags|default:'' }}">
          <span class="dot" aria-hidden="true"></span>
          <div>{{ message }}</div>
        </div>
      {% endfor %}
    {% endif %}

    <!-- ===== Upload form ===== -->
    <form method="post" enctype="multipart/form-data" novalidate>
      {% csrf_token %}

      <!--
        أمان (Server-side):
        - تحققي من حجم الملف ونوعه في Django (validators) لأن accept/client checks ليست حماية.
        - خزّني الملفات بأسماء آمنة (مثلاً UUID) وتجنبي استخدام اسم المستخدم كاسم فعلي في التخزين.
      -->
      <label for="id_file">الملف</label>
      <input id="id_file" name="file" type="file" />

      <!-- Dropzone: click + drag & drop -->
      <div class="drop" id="drop" role="button" tabindex="0" aria-label="منطقة رفع الملف">
        <div class="meta">
          <strong id="name">لم يتم اختيار ملف</strong>
          <span id="info">اضغطي للاختيار أو اسحبي الملف هنا</span>
        </div>

        <button type="button" class="pick" id="pick">اختيار ملف</button>
      </div>

      <button class="btn" id="submit" disabled>رفع الملف</button>
      <div class="hint">لن يبدأ الرفع إلا بعد اختيار ملف.</div>
    </form>
  </main>

  <script>
    /*
      ✅ JS Minimal + Secure
      - بدون مكتبات
      - لا نستخدم innerHTML (حماية من إدخال HTML)
      - Drag&Drop + Accessibility (Enter/Space)
      - التحقق الحقيقي للحجم/النوع يجب أن يكون في السيرفر
    */
    (() => {
      const input = document.getElementById('id_file');
      const pick  = document.getElementById('pick');
      const drop  = document.getElementById('drop');
      const name  = document.getElementById('name');
      const info  = document.getElementById('info');
      const btn   = document.getElementById('submit');

      // حد اختياري لعرض تحذير (ليس حماية) — غيّريه حسب مشروعك
      const UI_MAX_MB = 20;

      const formatSize = (bytes) => {
        const units = ['B','KB','MB','GB'];
        let i = 0, b = bytes;
        while (b >= 1024 && i < units.length - 1) { b /= 1024; i++; }
        return `${b.toFixed(i ? 1 : 0)} ${units[i]}`;
      };

      const updateUI = () => {
        const file = input.files && input.files[0];
        btn.disabled = !file;

        if (!file) {
          name.textContent = 'لم يتم اختيار ملف';
          info.textContent = 'اضغطي للاختيار أو اسحبي الملف هنا';
          return;
        }

        name.textContent = file.name;
        const mb = file.size / (1024 * 1024);
        info.textContent = `الحجم: ${formatSize(file.size)}${mb > UI_MAX_MB ? ' — قد يكون كبيرًا' : ''}`;
      };

      const openPicker = () => input.click();

      // اختيار ملف
      pick.addEventListener('click', openPicker);

      // النقر على منطقة الرفع (مع تجاهل زر الاختيار)
      drop.addEventListener('click', (e) => {
        if (e.target === pick) return;
        openPicker();
      });

      // لوحة المفاتيح (Accessiblity)
      drop.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openPicker();
        }
      });

      // تحديث عند اختيار ملف
      input.addEventListener('change', updateUI);

      // ===== Drag & Drop =====
      const prevent = (e) => { e.preventDefault(); e.stopPropagation(); };

      ['dragenter','dragover'].forEach(ev => {
        drop.addEventListener(ev, (e) => {
          prevent(e);
          drop.classList.add('is-dragover');
        });
      });

      ['dragleave','drop'].forEach(ev => {
        drop.addEventListener(ev, (e) => {
          prevent(e);
          drop.classList.remove('is-dragover');
        });
      });

      drop.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        if (!dt || !dt.files || !dt.files.length) return;

        // تعيين الملفات داخل input (مدعوم غالبًا)
        input.files = dt.files;
        updateUI();
      });

      updateUI();
    })();
  </script>
</body>
</html>